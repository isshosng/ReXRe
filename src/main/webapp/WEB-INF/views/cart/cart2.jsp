<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>리바이리 (ReXRe)</title>

<link rel="shortcut icon" type="image/x-icon"
	href="https://www.rexremall.com/favicon.ico" />
<link rel="stylesheet" type="text/css"
	href="https://www.rexremall.com/_data/wing_skbioland_200731_temp.css" />
<link rel="stylesheet" type="text/css"
	href="https://www.rexremall.com/wm_engine_SW/_engine/common/jquery/jquery-ui.min.css" />
<link rel="stylesheet" type="text/css"
	href="https://www.rexremall.com/wm_engine_SW/_engine/common/loading.css??202212281151" />

<script type="text/javascript">
	var hid_frame = "hidden1672195870";
	var mlv = "9";
	var alv = "";
	var root_url = "https://www.rexremall.com";
	var engine_url = "https://www.rexremall.com/wm_engine_SW";
	var this_url = "https://www.rexremall.com/shop/cart.php";
	var ssl_url = "https://www.rexremall.com/main/exec.php";
	var soldout_name = "품절";
	var ace_counter_gcode = "";
	var uip = "112.221.225.164";
	var currency = "원";
	var currency_type = "원";
	var currency_decimal = "0";
	var r_currency_type = "";
	var r_currency_decimal = "0";
	var exchangeRate = "";
	var juso_api_use = "Y";
	var browser_type = "pc";
	var mobile_browser = "";
	var ssl_type = "Y";

	var click_prd = new Array();
	click_prd[1] = '<a href="https://www.rexremall.com/shop/detail.php?pno=58D4D1E7B1E97B258C9ED0B37E02D087&cno1=1001"><img src="https://skbiolandmall.wisacdn.com/_data/product/202208/08/9d67faf5de5906f682b3bb52fef7a3dc.jpg" width="51" height="62" alt="리바이리 콤부차 배리옴 릴리프 마스크 1매-6,500" title=""></a>';
	click_prd[2] = '<a href="https://www.rexremall.com/shop/detail.php?pno=B2EEB7362EF83DEFF5C7813A67E14F0A&cno1=1001"><img src="https://skbiolandmall.wisacdn.com/_data/product/202208/22/d52eed1ad2c623bd89d0363b846c1365.jpg" width="51" height="62" alt="리바이리 콤부차 배리옴 스킨케어 5종 기획-170,000" title=""></a>';
	var click_prd_limit = 2;
	var click_prd_start = 1;
	var click_prd_finish = click_prd_limit + 1;
</script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/jquery/jquery-1.11.3.min.js"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/jquery/jquery-ui-1.11.3.min.js"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/jquery.serializeObject.js"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/_skin/skbioland_200731/script.js"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/lang/lang_kor.js?00000002"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/common.js?202212281151"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/shop.review.js?202212281151"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/R2Na/R2Na.js"></script>
<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/smartEditor/js/HuskyEZCreator.js"></script>
<script type="text/javascript">
	var date_picker_default = {
		monthNamesShort : [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10",
				"11", "12", ],
		dayNamesMin : [ _lang_pack.data_week_sun, _lang_pack.data_week_mon,
				_lang_pack.data_week_tue, _lang_pack.data_week_wed,
				_lang_pack.data_week_thu, _lang_pack.data_week_fri,
				_lang_pack.data_week_sat, ],
		weekHeader : "Wk",
		dateFormat : "yy-mm-dd",
		autoSize : false,
		changeYear : true,
		changeMonth : true,
		showButtonPanel : true,
		currentText : _lang_pack.common_info_today + "2022-12-28",
		closeText : _lang_pack.coommon_info_close,
	};

	/* Timer */
	const use_ts_mark_1 = "Y";
	const ts_mark_1 = "일";
	const use_ts_mark_2 = "Y";
	const ts_mark_2 = " :";
	const use_ts_mark_3 = "Y";
	const ts_mark_3 = " :";
	const use_ts_mark_4 = "Y";
	const ts_mark_4 = "";
</script>

<script type="text/javascript"
	src="https://www.rexremall.com/wm_engine_SW/_engine/common/sec.js"></script>
<script type="text/javascript" src="//wcs.naver.net/wcslog.js"></script>



<link rel="canonical" href="https://rexremall.com/" />


</head>

<body>





	<iframe name="hidden1672195870" src="about:blank" width="0" height="0"
		scrolling="no" frameborder="0" style="display: none"></iframe>

	<script type="text/javascript"
		src="https://www.rexremall.com/wm_engine_SW/_engine/common/shop.js?20200630"></script>
	<script type="text/javascript"
		src="https://www.rexremall.com/wm_engine_SW/_engine/common/shop.prdcpn.js?20200630"></script>
	<script type="text/javascript">
		var ace_counter_cart = "";
		var order_cpn_paytype = "1";
		var order_milage_paytype = "1";
		var order_cpn_milage = "1";
		var usable_emoney = 0;
		var prdprc_sale = 0;
		var delivery_type = "3";
		var exchangeRate = "";
	</script>
	<script type="text/javascript" defer="defer">
		$(document).ready(function() {
			setInterval("wingQuickSlide(228, 0, 0, 5)", 10);
		});
	</script>
	<style type="text/css">
<!--
#skin_shop_cart_big_div {
	width: 100%;
}
-->
</style>
	<div id="skin_shop_cart_big_div">
		<script
			src="https://www.rexremall.com/_skin/skbioland_200731/img/../slick.min.js"></script>
		<link rel="stylesheet" type="text/css"
			href="https://www.rexremall.com/_skin/skbioland_200731/img/../slick.css" />
		<link rel="stylesheet" type="text/css"
			href="https://www.rexremall.com/_skin/skbioland_200731/img/../animate.css" />
		<i id="crema-login-username" style="display: none">95parksh</i> <i
			id="crema-login-name" style="display: none">박성환</i>
		<div id="wrapper">

			<!--상단 -->
			<%@ include file="/WEB-INF/views/include/header.jsp"%>
			<!--//상단 -->


			<!-- 중앙 -->
			<div id="cnt">
				<div class="cntbody">

					<h2 class="subtitle">장바구니</h2>

					<ul id="order_step" class="order_step">
						<li class="active">
							<p class="number">01</p>
							<p class="txt">장바구니</p>
						</li>
						<li>
							<p class="number">02</p>
							<p class="txt">주문/결제</p>
						</li>
						<li>
							<p class="number">03</p>
							<p class="txt">주문완료</p>
						</li>
					</ul>


					<div id="cart">
						<form name="cartFrm" method="post"
							action="https://www.rexremall.com/main/exec.php"
							target="hidden1672195870" style="margin: 0px">
							<input type="hidden" name="exec_file" value="cart/cart.exe.php" />
							<input type="hidden" name="exec" value="update" /> <input
								type="hidden" name="is_quickcart" value="" />

							<div class="top_btn tar">
								<span class="box_btn w127 h45 fs15 white2 kor"></span>
							</div>

							<div class="enterprise headY">
								<p class="msg_delivery">
									<strong>장바구니 (3)</strong> <span>/ 30,000원 이상 구매 시 무료배송</span>
								</p>
							</div>
							<table class="tbl_col prd">
								<caption class="hidden">장바구니</caption>
								<colgroup>
									<col style="width: 5.25%" />
									<col style="width: 7.62%" />
									<col />
									<col style="width: 12%" />
									<col style="width: 9.23%" />
									<col style="width: 10.25%" />
									<col style="width: 8.55%" />
									<col style="width: 6.94%" />
									<col style="width: 11.61%" />
								</colgroup>
								<thead>
									<tr>
										<th scope="col"><input type="checkbox"
											onclick="cartCheckAll(this.checked)" id="allCheck" /></th>
										<th scope="col" colspan="2">상품명</th>
										<th scope="col"></th>
										<th scope="col"></th>
										<th scope="col">수량</th>
										<th scope="col">총금액</th>
										<th scope="col"></th>
										<th scope="col">삭제</th>
									</tr>
								</thead>
								<tbody class="test">

									<c:forEach var="cartItem" items="${cartItems}"
										varStatus="status">
										<tr class="checked" id="itemNum${status.count}">
											<td><input type="checkbox" name="chBox" class="chBox"
												data-product_id="${cartItem.PRODUCT_ID}"
												data-status="itemNum${status.count}" data-price="item_p${status.count}"/></td>
											<td><a
												href="#"><img
													src="${cartItem.IMAGE_PATH}" width="82" height="100"
													barder="0" /></a></td>
											<td class="name tal"><a href="상품디테일주소뿌려주기">${cartItem.PRODUCT_NAME}</a></td>
											<td>
												<div></div>
											</td>
											<td class="prc"></td>
											<td class="qty">
												<div class="box_qty">
													<input type="text" name="buy_ea[]"
														value="${cartItem.CART_QUANTITY}"
														id="buy_ea${status.count}" class="form_input"
														isplaceholderinited="true" />
													<div class="btn_ea">
														<a href="#"
															onclick="updateQuantity(${cartItem.PRODUCT_ID}, ${cartItem.CART_QUANTITY}, 255, 1,${status.count}); return false;"
															class="ea_up" id="${status.count}"></a> <a href="#"
															onclick="updateQuantity(${cartItem.PRODUCT_ID}, ${cartItem.CART_QUANTITY}, 255, -1,${status.count}); return false;"
															class="ea_down" id="${status.count}"></a>
													</div>
												</div>

											</td>
											<td class="prc cart_prc">
												<p id="item_p${status.count}">
													<strong><fmt:formatNumber
															value="${cartItem.PRODUCT_PRICE * cartItem.CART_QUANTITY}"
															pattern="#,###" type="number" /></strong>원

												</p> <input type="hidden" class="og_price"
												id="og_price${status.count}"
												value="${cartItem.PRODUCT_PRICE}"> <input
												type="hidden" class="product_id"
												id="product_id${status.count}"
												value="${cartItem.PRODUCT_ID}">
												<p id="item_p">
													<strong></strong>
												</p>
											</td>
											<td class="prc"></td>
											<td class="delete_wish"><span
												class="box_btn w79 h29 gray fs13 light kor"><a
													href="#"
													onclick="deleteCartOne(${cartItem.PRODUCT_ID}, ${status.count}, 255); return false;">삭제</a></span>
											</td>
										</tr>
									</c:forEach>
								</tbody>
							</table>

							<!-- 장바구니 버튼 -->
							<div class="btn">
								<div class="left">
									<span class="box_btn w117 h45 fs15 kor white"><a
										href="#" class="selectDelete_btn">선택삭제</a></span> <span
										class="box_btn w117 h45 fs15 kor white"><a
										onclick="deleteAllCartAjax2();">장바구니 비우기</a></span>
								</div>
								<div class="right">
									<span class="box_btn w117 h45 fs15 kor white"><a
										href="https://www.rexremall.com/shop/big_section.php?cno1=1020">계속
											쇼핑하기</a></span> <span class="box_btn w117 h45 fs15 kor"><a
										href="#" class="selectOrder_btn">선택상품
											주문</a></span>
								</div>
							</div>
							<!-- //장바구니 버튼 -->
							<div class="box">
								<table class="tbl_order2">
									<caption class="hidden">총 주문 가격</caption>
									<colgroup>
										<col style="width: 50%" />
										<col />
									</colgroup>
									<tbody>
										<tr>
											<th scope="row">주문금액</th>
											<td><span class="total_prd_prc"></span>원</td>
										</tr>
										<tr>
											<th scope="row">배송료</th>
											<td><span id="dlv_prc_cart" class="dlv_prc_cart">0</span>원
											</td>
										</tr>


									</tbody>
								</table>
								<dl class="total">
									<dt scope="row">총주문금액</dt>
									<dd>
										<strong><span id="total_order_price_cartlist"
											class="price total_order_price_cartlist"></span>원 </strong>
									</dd>
								</dl>
							</div>
							<div class="bottom_btn tac">
								<span class="box_btn w180 h65 fs17 kor"><a
									href="javascript:orderCart(document.cartFrm);">상품 주문하기</a></span>
							</div>
							<input type="hidden" name="cart_rows" value="2" /><input
								type="hidden" id="partner_data" name="partner_data" value="" />
						</form>
					</div>


					<script type="text/javascript">
					
					$("#allCheck").click(function(){
						 var chk = $("#allCheck").prop("checked");
						 if(chk) {
						  $(".chBox").prop("checked", true);
						 } else {
						  $(".chBox").prop("checked", false);
						 }
						 total_price_calc();
						});

					
					 $(".chBox").click(function(){
						  $("#allCheck").prop("checked", false);
						  total_price_calc();
						 });
					 
					 
					 
					 
					 //선택삭제
					 $(".selectDelete_btn").click(function(){
						 
						  var confirm_val = confirm("정말 삭제하시겠습니까?");
						  
						  if(confirm_val) {
						   var checkArr = new Array();
						   var deleteNum = new Array();
						   
						   
						   $("input[class='chBox']:checked").each(function(){
							   
						    checkArr.push($(this).attr("data-product_id"));
						    deleteNum.push($(this).attr("data-status"));
						    
						   });
						    
						   $.ajax({
						    url : "/shop/cartDelChecked",
						    type : "get",
						    data : { chbox : checkArr },
						    success : function(){
						    	
						    	deleteNum.forEach(
						    			itemNum => $( 'tr' ).remove( '#'+itemNum )
						    			);
							  
							  total_price_calc();
							  Cart_Num_calc();
						    }
						   });
						   
						  } 
						 });
					 
					 
					 //선택 주문
					 $(".selectOrder_btn").click(function(){
						 
						  var confirm_val = confirm("주문하시겠습니까?");
						  
						  if(confirm_val) {
							  
							let idquery = '?id='
						   var checkArr = new Array();
						  
						   
						   $("input[class='chBox']:checked").each(function(){
							
							   idquery=idquery + $(this).attr("data-product_id") + ','
						    checkArr.push($(this).attr("data-product_id"));
						    
						    
						   });
						   
						   idquery = idquery.slice(0, -1);
						   
						   console.log(checkArr);
						   console.log(idquery);
						    
						   location.href = "/shop/order"+idquery;
						   
						  } 
						 });
					 
					 
						
						
						$(document).ready(function(){
						     total_price_calc();
						     Cart_Num_calc();
						  });
						
						
						
						function intToWon(s) {
							
							  return s.toLocaleString() + '원';
							}
						
						function wonToInt(s) {
							  return parseInt(s.substr(0, s.length - 1).replaceAll(',', ''));
							}
						
						
						
						
						// 함수에 직접 프로덕트 아이디 가져오기
						// 아이템 하나 삭제
						function deleteCartOne(product_id, status, member_id) {
							
							// 멤버아이디는 세션에서 받아서 넘겨줘야함.
							
							var confirm_val = confirm("정말 삭제하시겠습니까?");
							  
							  if(confirm_val) {
							
							
							
							$.ajax({
							 	
	 							
								type:"get",  //전송타입
								url:"/shop/cartDelOne",//서버요청대상파일
								data:{
									
									product_id: product_id,
									member_id: member_id							
							 
						 			},
						 			contentType : "application/json",
						 
						 			success: function () { 
									
						 				console.log("석세스");
						 	
							 		
						 				$( 'tr' ).remove( '#itemNum'+status );								  
							  
										  total_price_calc();
										  Cart_Num_calc();
								  
								 }, 
								 error:function(request,status,error){
						       		 alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
					      		 }
						 
						
								});
							  }
							
								}
						
						
						
						
						// 아이템을 담고있는 tr id를 돌면서 모두 삭제. $( "[id^='itemNum']" ).remove() : id가  itemNum으로 시작하는 객체들 선택
						function deleteAllCartAjax2() {	
							
							var confirm_val = confirm("정말 삭제하시겠습니까?");
							  
							  if(confirm_val) {
							
							
							
								$.ajax({							 	
	 							
								type:"get",  //전송타입
								url:"/shop/cartDelAll",//서버요청대상파일
								
						 
						 			success: function () { 
									
						 				console.log("석세스");
						 	
							 		
						 				$( "[id^='itemNum']" ).remove();
										total_price_calc();
										Cart_Num_calc();
								  
								 }, 
								 error:function(request,status,error){
						       		 alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
					      		 }
						 
						
								});
							  }
							
							
							
							
							
							}
						
						
						
						 // 총 가격 계산
						 function total_price_calc(){
						    
						     let final_price = 0; // 최종적으로 결제해야하는 가격 
						     let deliveryfee = 0; // 배송비
						     let og_price = 0;
						     
						     
						     var checkArr = new Array();
							   var PriceNum = new Array();
							   
							   $("input[class='chBox']:checked").each(function(){
								   
							    checkArr.push($(this).attr("data-product_id"));
							    
							    PriceNum.push($(this).attr("data-price"));
							    console.log($(this).attr("data-price"));
							   });
							   
						     
							   PriceNum.forEach(
						    			itemNum => {
						    				
						    				let origin = wonToInt($('#'+itemNum).text());

									    	 final_price += parseInt(origin);	
						    				
						    				
						    			}
						    			);
						     
						     
						     
						     
						     
						    
						           
						      /* 최종 가격 */
						      
						      //배송비
						      let delivery = 0;
						      

						     
						      $(".total_prd_prc").text(final_price.toLocaleString());
						     
						      
						      if(final_price < 150000){
						    	  
						    	  delivery = 4000;
						    	  final_price += delivery;
						    	  $(".dlv_prc_cart").text(delivery.toLocaleString());
						    	  $(".total_order_price_cartlist").text(final_price.toLocaleString());
						    	  
						      }else{
						    	  $(".dlv_prc_cart").text(0);
						    	  $(".total_order_price_cartlist").text(final_price.toLocaleString());
						      }
						      
						      
						      
						      console.log(final_price);
						     
						  }	
						
												 
						
						 
						 // this 객체의 status 값을 가지고 찾아 변경해주기
							$('.ea_up2').click(function () {
								
									
								let og_price_id = 'og_price' + $(this).attr('id');
								  let og_price = $('#'+og_price_id).val();
								  
								  // this 의 id = status로 설정해놓고 현재 status를 찾은것이다.
								  // 그냥 위 delete처럼 바로 파라미터로 넣어도 될것같다.
								  
								  let product_id_id = 'product_id' + $(this).attr('id');
								  let product_id = $('#'+product_id_id).val();
								 
								  							  
								  let quantity_id ='buy_ea' + $(this).attr('id');
								  let quantity = $('#'+quantity_id).val();
								  
								  let price = og_price*quantity;								  
								
								  let p_id ='item_p' + $(this).attr('id');								
								  
								  $('#'+ p_id).text(intToWon(price));
								  
								  
								  
								  console.log(og_price);
								  console.log(product_id);
								  console.log(quantity);
								  
								  
								  total_price_calc()
								  
							
							});
						
							
							
							
							$('.ea_down2').click(function () {
								
								  let og_id = 'og_price' + $(this).attr('id');
								  let og_price = $('#'+og_id).val();
								  
								  let quantity_id ='buy_ea' + $(this).attr('id');
								  let quantity = $('#'+quantity_id).val();
								  
								  let price = og_price*quantity;
								  
								
								  let p_id ='item_p' + $(this).attr('id');
								
								  
								  $('#'+ p_id).text(intToWon(price));
								  
								  total_price_calc()
								  
							
							});
							
							
							function updateQuantity(product_id, product_qauntity,member_id,update_num, status){
								
								
								console.log(product_qauntity);
								
							
							 	let og_price = $('#og_price'+status).val();
							 	
							 	console.log(og_price);
								 
							 
								  let quantity_id ='buy_ea' + status;
								  let quantity = parseInt($('#'+quantity_id).val()) + update_num ;
								  
								  if(quantity==0){
									  quantity=1;
									  return;
								  }
								  
								  
								  console.log(quantity);
								  
							  	let price = og_price*quantity;				
							  	
							  	 console.log(price);
							
							 	 let p_id ='item_p' + status;		
							  	let quan_val_id = 'buy_ea' + status;
							  	
							  	console.log(quantity);
								
							 
								
								
	 							$.ajax({
									 	
	 							
										type:"get",  //전송타입
										url:"/shop/upQuantity",//서버요청대상파일
										data:{
											product_qauntity: quantity,
											product_id: product_id,
											member_id: member_id,
										
									 
								 			},
								 			contentType : "application/json",
								 
								 		success: function () { 
											
								 		console.log("석세스");
								 		console.log(product_qauntity);
									 		
										  $('#'+ quan_val_id).val(quantity);
										  $('#'+ p_id).text(intToWon(price));									  
									  
										  total_price_calc();
										  
								 }, error:function(request,status,error){
								        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
							       }
								 
								
								});
								
							}
							
							
							 function Cart_Num_calc(){
								 var Cart_Num = document.getElementsByClassName('checked').length;
							       
								 	console.log(Cart_Num);
								 
							        $(".quick_cart_cnt").text(Cart_Num);
							       
								 
							 
							 }
							
							
							
							
					</script>

				</div>
			</div>
			<!-- //중앙 -->

			<!-- 하단 -->
			<%@ include file="/WEB-INF/views/include/footer.jsp"%>
			<!-- //하단 -->

		</div>
		
	
	</div>
	<script type="text/javascript" defer="defer">
		$(document).ready(function() {
		});
	</script>
	<script type="text/javascript"
		src="https://www.rexremall.com/wm_engine_SW/_engine/common/auto_scroll.js"
		defer="defer"></script>

	<script type="text/javascript"
		src="https://static.criteo.net/js/ld/ld.js" async="true"></script>
	<script type="text/javascript">
		window.criteo_q = window.criteo_q || [];
		window.criteo_q.push({
			event : "setAccount",
			account : "71354"
		}, {
			event : "setEmail",
			type : "95parksh@naver.com"
		}, {
			event : "setSiteType",
			type : "d"
		}, {
			event : "viewBasket",
			item : [ {
				id : "B2EEB7362EF83DEFF5C7813A67E14F0A",
				price : "153000.00",
				quantity : "3",
			}, {
				id : "58D4D1E7B1E97B258C9ED0B37E02D087",
				price : "5850.00",
				quantity : "2",
			}, ],
		});
		
		
		
		
		
		
	</script>

	<script type="text/javascript">
		if (typeof wcs != "undefined") {
			if (typeof cpa == "undefined")
				var cpa = {};
			if (cpa["order"]) {
				cpa["cnv"] = wcs.cnv("1", "0");
			}
			wcs_do(cpa);
		}
	</script>
	<span itemscope="" itemtype="http://schema.org/Organization">
		<link itemprop="url" href="https://www.rexremall.com" /> <a
		itemprop="sameAs" href="https://www.facebook.com/officialrexre/"></a>
		<a itemprop="sameAs" href="https://pf.kakao.com/_xjFMxbT"></a> <a
		itemprop="sameAs" href="https://www.instagram.com/rexre.official"></a>
	</span>

	<div id="criteo-tags-div" style="display: none"></div>
	<div id="mbris_bounce_section"
		style="height: 0px; z-index: 100000; visibility: hidden; overflow: hidden">
		<iframe scrolling="no" id="iframe_mbris_bounce_section"
			style="width: 100%; height: 0px; border: none; opacity: 0"></iframe>
	</div>
	<iframe height="0" width="0" title="Criteo DIS iframe"
		style="display: none"></iframe>
	<iframe style="display: none"></iframe>
	<hv-copy-modal></hv-copy-modal>
	<!-- Code injected by live-server -->


	<div id="criteo-tags-div" style="display: none"></div>
	<iframe style="display: none"></iframe>
	<iframe height="0" width="0" title="Criteo DIS iframe"
		style="display: none"></iframe>
	<hv-copy-modal></hv-copy-modal>
</body>
</html>
